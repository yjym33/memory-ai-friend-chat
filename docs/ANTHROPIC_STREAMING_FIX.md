# Anthropic λ¨λΈ μ¤νΈλ¦¬λ° μ‘λ‹µ λ¬Έμ  μμ •

## λ¬Έμ  μƒν™©

Anthropic λ¨λΈ(Claude)λ΅ λ³€κ²½ν–μ„ λ• LLMμ΄ μ λ€λ΅ λ‹µλ³€ν•μ§€ λ»ν•κ³  "μ²λ¦¬μ¤‘"μ΄λΌκ³ λ§ λ‚μ¤λ” λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤.

## μ›μΈ λ¶„μ„

1. **μ¤νΈλ¦¬λ° μ΄λ²¤νΈ μ²λ¦¬ λ¶μ™„μ „**: Anthropic SDKμ μΌλ¶€ μ¤νΈλ¦¬λ° μ΄λ²¤νΈ νƒ€μ…μ„ μ²λ¦¬ν•μ§€ λ»ν•¨
2. **μ—λ¬ μ „λ‹¬ λ¶€μ΅±**: μ—λ¬κ°€ λ°μƒν•΄λ„ ν”„λ΅ νΈμ—”λ“λ΅ μ „λ‹¬λμ§€ μ•μ
3. **λ΅κΉ… λ¶€μ΅±**: λ¬Έμ  μ§„λ‹¨μ„ μ„ν• λ””λ²„κΉ… λ΅κ·Έκ°€ λ¶€μ΅±ν•¨
4. **νλΌλ―Έν„° λ„λ½**: `top_k` λ“± μΌλ¶€ νλΌλ―Έν„°κ°€ μ”μ²­μ— ν¬ν•¨λμ§€ μ•μ

## μμ • μ‚¬ν•­

### 1. AnthropicProvider μ¤νΈλ¦¬λ° μ²λ¦¬ κ°μ„ 

**νμΌ**: `chatbot-backend/src/llm/providers/anthropic.provider.ts`

**μ£Όμ” κ°μ„  μ‚¬ν•­**:
- λ¨λ“  μ¤νΈλ¦¬λ° μ΄λ²¤νΈ νƒ€μ… μ²λ¦¬ (`content_block_start`, `content_block_delta`, `content_block_stop`, `message_delta`, `message_stop`)
- μƒμ„Έν• λ””λ²„κΉ… λ΅κ·Έ μ¶”κ°€
- μ½ν…μΈ  μμ‹  μ—¬λ¶€ ν™•μΈ λ° κ²½κ³ 
- `top_k` νλΌλ―Έν„° μ§€μ› μ¶”κ°€
- μ—λ¬ μƒμ„Έ μ •λ³΄ λ΅κΉ…

**λ³€κ²½λ λ©”μ„λ“**:
```typescript
async generateStreamingResponse(
  request: LLMRequest,
  onChunk: (chunk: LLMStreamChunk) => void,
  apiKey?: string,
): Promise<void>
```

**κ°μ„ λ μ²λ¦¬ λ΅μ§**:
1. μ¤νΈλ¦¬λ° μ”μ²­ μƒμ„± μ‹ λ¨λ“  νλΌλ―Έν„° ν¬ν•¨ (`top_k`, `top_p` λ“±)
2. λ¨λ“  μ΄λ²¤νΈ νƒ€μ… μ²λ¦¬
3. μ½ν…μΈ  μμ‹  μ—¬λ¶€ μ¶”μ 
4. μƒμ„Έν• μ—λ¬ λ΅κΉ…

### 2. ChatService μ—λ¬ μ²λ¦¬ κ°μ„ 

**νμΌ**: `chatbot-backend/src/chat/chat.service.ts`

**μ£Όμ” κ°μ„  μ‚¬ν•­**:
- `generateLLMResponseStream` λ©”μ„λ“μ— μ—λ¬ μ²λ¦¬ μ¶”κ°€
- μ—λ¬λ¥Ό μƒμ„λ΅ μ „νν•μ—¬ ChatControllerμ—μ„λ„ μ²λ¦¬ κ°€λ¥
- μƒμ„Έν• μ—λ¬ λ΅κΉ…

**λ³€κ²½λ λ©”μ„λ“**:
```typescript
private async generateLLMResponseStream(
  userId: string,
  messages: Array<{ role: string; content: string }>,
  onChunk: (chunk: string) => void,
): Promise<void>
```

### 3. μ—λ¬ μ „ν κ°μ„ 

**νμΌ**: `chatbot-backend/src/chat/chat.service.ts`

**κ°μ„  μ‚¬ν•­**:
- `processPersonalMessageStream`μ—μ„ μ—λ¬ λ°μƒ μ‹ μƒμ„λ΅ μ „ν
- μ—λ¬ λ©”μ‹μ§€λ¥Ό μ‚¬μ©μμ—κ² μ „λ‹¬
- μƒμ„Έν• μ—λ¬ μ •λ³΄ λ΅κΉ…

## ν…μ¤νΈ λ°©λ²•

### 1. Anthropic λ¨λΈ μ„ νƒ

1. AI μΉκµ¬ μ„¤μ •μ—μ„ Providerλ¥Ό "Anthropic (Claude)"λ΅ λ³€κ²½
2. λ¨λΈ μ„ νƒ (μ: Claude 3.5 Sonnet)
3. API ν‚¤ μ…λ ¥ (ν•„μ)

### 2. λ€ν™” ν…μ¤νΈ

1. μ±„ν…μ°½μ—μ„ λ©”μ‹μ§€ μ „μ†΅
2. λ°±μ—”λ“ λ΅κ·Έ ν™•μΈ:
   ```
   π”„ Anthropic Claude μ¤νΈλ¦¬λ° μ‘λ‹µ μ‹μ‘
   μ¤νΈλ¦¬λ° μ”μ²­ μ •λ³΄ - λ¨λΈ: claude-3-5-sonnet-20241022, ...
   μ¤νΈλ¦¬λ° μ΄λ²¤νΈ #1: content_block_start
   μ¤νΈλ¦¬λ° μ™„λ£ - μ΄ μ΄λ²¤νΈ: X, μ…λ ¥ ν† ν°: Y, μ¶λ ¥ ν† ν°: Z, μ½ν…μΈ  μμ‹ : μ
   β… Anthropic Claude μ¤νΈλ¦¬λ° μ‘λ‹µ μ™„λ£
   ```

### 3. μ—λ¬ λ°μƒ μ‹ ν™•μΈ

μ—λ¬κ°€ λ°μƒν•λ©΄ λ°±μ—”λ“ λ΅κ·Έμ—μ„ λ‹¤μ μ •λ³΄ ν™•μΈ:
- μ—λ¬ λ©”μ‹μ§€
- HTTP μ‘λ‹µ μƒνƒ μ½”λ“
- μ‘λ‹µ λ³Έλ¬Έ
- μ¤νƒ νΈλ μ΄μ¤

## λ¬Έμ  ν•΄κ²° μ²΄ν¬λ¦¬μ¤νΈ

- [ ] Anthropic API ν‚¤κ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈ
- [ ] API ν‚¤ ν•μ‹μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ (`sk-ant-` λλ” `sk-ant-api`λ΅ μ‹μ‘ν•΄μ•Ό ν•¨)
- [ ] λ¨λΈ μ΄λ¦„μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ (μ‚¬μ© κ°€λ¥ν• λ¨λΈ λ©λ΅ ν™•μΈ)
- [ ] λ°±μ—”λ“ λ΅κ·Έμ—μ„ μ—λ¬ λ©”μ‹μ§€ ν™•μΈ
- [ ] μ¤νΈλ¦¬λ° μ΄λ²¤νΈκ°€ μ •μƒμ μΌλ΅ μμ‹ λλ”μ§€ ν™•μΈ
- [ ] μ½ν…μΈ κ°€ μμ‹ λλ”μ§€ ν™•μΈ (λ΅κ·Έμ— "μ½ν…μΈ  μμ‹ : μ" ν‘μ‹)

## μμƒ λ΅κ·Έ μ¶λ ¥

### μ •μƒ μ‘λ™ μ‹

```
π”„ Anthropic Claude μ¤νΈλ¦¬λ° μ‘λ‹µ μ‹μ‘
π”‘ Anthropic API ν‚¤ ν™•μΈ - μ‚¬μ©μ ν‚¤: μμ (sk-ant-api...), μ‹μ¤ν… ν‚¤: μ—†μ, μµμΆ… ν‚¤: μμ (sk-ant-api...)
β… Anthropic API ν‚¤ ν•μ‹ ν™•μΈ μ™„λ£
μ¤νΈλ¦¬λ° μ”μ²­ μ •λ³΄ - λ¨λΈ: claude-3-5-sonnet-20241022, λ©”μ‹μ§€ μ: 2, μ‹μ¤ν… λ©”μ‹μ§€: μμ
μ¤νΈλ¦¬λ° μ™„λ£ - μ΄ μ΄λ²¤νΈ: 15, μ…λ ¥ ν† ν°: 123, μ¶λ ¥ ν† ν°: 456, μ½ν…μΈ  μμ‹ : μ
β… Anthropic Claude μ¤νΈλ¦¬λ° μ‘λ‹µ μ™„λ£
```

### μ—λ¬ λ°μƒ μ‹

```
β Anthropic Claude μ¤νΈλ¦¬λ° API νΈμ¶ μ‹¤ν¨: ...
HTTP μ‘λ‹µ: 401 Unauthorized
μ‘λ‹µ λ³Έλ¬Έ: {"error":{"type":"authentication_error",...}}
μ—λ¬ λ©”μ‹μ§€: Anthropic API ν‚¤κ°€ μ ν¨ν•μ§€ μ•μµλ‹λ‹¤.
```

## μ¶”κ°€ κ°μ„  μ‚¬ν•­

ν–¥ν›„ κ°μ„ ν•  μ μλ” μ‚¬ν•­:

1. **μ¬μ‹λ„ λ΅μ§**: μΌμ‹μ  μ—λ¬ λ°μƒ μ‹ μλ™ μ¬μ‹λ„
2. **νƒ€μ„μ•„μ›ƒ μ„¤μ •**: μ¤νΈλ¦¬λ° μ”μ²­μ— νƒ€μ„μ•„μ›ƒ μ„¤μ •
3. **μ—λ¬ λ¶„λ¥**: μ—λ¬ νƒ€μ…λ³„λ΅ λ‹¤λ¥Έ μ²λ¦¬ λ΅μ§ μ μ©
4. **λ©”νΈλ¦­ μμ§‘**: μ¤νΈλ¦¬λ° μ„±κ³µλ¥ , μ‘λ‹µ μ‹κ°„ λ“± λ©”νΈλ¦­ μμ§‘

