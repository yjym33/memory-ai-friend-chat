# API ν‚¤ μ €μ¥ λ° μ‚¬μ© λ¬Έμ  ν•΄κ²° κ°€μ΄λ“

## λ¬Έμ  μƒν™©

Anthropic Claude λ¨λΈμ„ μ‚¬μ©ν•κΈ° μ„ν•΄ ν”„λ΅ νΈμ—”λ“μ—μ„ API ν‚¤λ¥Ό μ…λ ¥ν•κ³  μ €μ¥ν–λ”λ°, LLM νΈμ¶μ΄ μ• λλ” κ²½μ°κ°€ μμµλ‹λ‹¤.

## κ°€λ¥ν• μ›μΈ λ° ν•΄κ²° λ°©λ²•

### 1. API ν‚¤κ°€ μ‹¤μ λ΅ μ €μ¥λμ§€ μ•μ•μ„ μ μμµλ‹λ‹¤

**ν™•μΈ λ°©λ²•:**
- λΈλΌμ°μ € κ°λ°μ λ„κµ¬μ Network νƒ­μ—μ„ `/auth/api-keys/all` μ”μ²­μ΄ μ„±κ³µν–λ”μ§€ ν™•μΈ
- λ°±μ—”λ“ λ΅κ·Έμ—μ„ "β… API ν‚¤ μ €μ¥ μ™„λ£" λ©”μ‹μ§€ ν™•μΈ

**ν•΄κ²° λ°©λ²•:**
- ν”„λ΅ νΈμ—”λ“μ—μ„ API ν‚¤λ¥Ό λ‹¤μ‹ μ…λ ¥ν•κ³  μ €μ¥
- μ €μ¥ ν›„ λΈλΌμ°μ € μ½μ†”μ—μ„ μ—λ¬ λ©”μ‹μ§€ ν™•μΈ

### 2. API ν‚¤ λ³µνΈν™” μ‹¤ν¨

**ν™•μΈ λ°©λ²•:**
- λ°±μ—”λ“ λ΅κ·Έμ—μ„ "β API ν‚¤ λ³µνΈν™” μ‹¤ν¨" λ©”μ‹μ§€ ν™•μΈ
- `EncryptionService`μ μ•”νΈν™”/λ³µνΈν™” ν‚¤ ν™•μΈ (`ENCRYPTION_KEY` ν™κ²½ λ³€μ)

**ν•΄κ²° λ°©λ²•:**
- `ENCRYPTION_KEY` ν™κ²½ λ³€μκ°€ μ„¤μ •λμ–΄ μλ”μ§€ ν™•μΈ
- μ•”νΈν™” ν‚¤κ°€ λ³€κ²½λλ©΄ κΈ°μ΅΄μ— μ•”νΈν™”λ ν‚¤λ” λ³µνΈν™”ν•  μ μ—†μΌλ―€λ΅ λ‹¤μ‹ μ €μ¥ ν•„μ”

### 3. μ‚¬μ©μ API ν‚¤λ¥Ό μ°Ύμ§€ λ»ν•λ” κ²½μ°

**ν™•μΈ λ°©λ²•:**
- λ°±μ—”λ“ λ΅κ·Έμ—μ„ "β οΈ μ‚¬μ©μ API ν‚¤κ°€ μ €μ¥λμ–΄ μμ§€ μ•μµλ‹λ‹¤" λ©”μ‹μ§€ ν™•μΈ
- `resolveApiKey` λ©”μ„λ“μ λ΅κ·Έ ν™•μΈ

**ν•΄κ²° λ°©λ²•:**
- μ‚¬μ©μ IDκ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ
- λ°μ΄ν„°λ² μ΄μ¤μ—μ„ User ν…μ΄λΈ”μ `llmApiKeys` ν•„λ“ ν™•μΈ

### 4. Providerκ°€ AnthropicμΈλ° λ¨λΈμ΄ Anthropic λ¨λΈμ΄ μ•„λ‹ κ²½μ°

**ν™•μΈ λ°©λ²•:**
- AI μ„¤μ •μ—μ„ `llmProvider`κ°€ `anthropic`μΈμ§€ ν™•μΈ
- μ„ νƒν• λ¨λΈμ΄ Anthropic λ¨λΈ λ©λ΅μ— μλ”μ§€ ν™•μΈ

**ν•΄κ²° λ°©λ²•:**
- AI μ„¤μ • λ¨λ‹¬μ—μ„ Providerλ¥Ό AnthropicμΌλ΅ λ³€κ²½
- Anthropic λ¨λΈ μ„ νƒ (μ: `claude-3-5-sonnet-20241022`)

### 5. μ‹μ¤ν… κΈ°λ³Έ ν‚¤λ„ μ—†λ” κ²½μ°

**ν™•μΈ λ°©λ²•:**
- λ°±μ—”λ“ λ΅κ·Έμ—μ„ "β Anthropic API ν‚¤λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤" λ©”μ‹μ§€ ν™•μΈ
- `.env` νμΌμ— `ANTHROPIC_API_KEY` μ„¤μ • ν™•μΈ

**ν•΄κ²° λ°©λ²•:**
- `.env` νμΌμ— `ANTHROPIC_API_KEY` μ¶”κ°€
- λλ” ν”„λ΅ νΈμ—”λ“μ—μ„ API ν‚¤ μ…λ ¥ ν›„ μ €μ¥

## λ””λ²„κΉ… λ°©λ²•

### λ°±μ—”λ“ λ΅κ·Έ ν™•μΈ

λ‹¤μ λ΅κ·Έ λ©”μ‹μ§€λ“¤μ„ ν™•μΈν•μ„Έμ”:

```
β… API ν‚¤ μ €μ¥ μ™„λ£ - Provider: anthropic
β… λ³µνΈν™” ν…μ¤νΈ μ„±κ³µ
π”‘ μ‚¬μ©μ API ν‚¤ μ΅°ν μ¤‘... Provider: anthropic
β… μ‚¬μ©μ API ν‚¤ λ³µνΈν™” μ„±κ³µ
π”‘ Anthropic API ν‚¤ ν™•μΈ - μ‚¬μ©μ ν‚¤: μμ, μ‹μ¤ν… ν‚¤: μ—†μ
```

### λ°μ΄ν„°λ² μ΄μ¤ μ§μ ‘ ν™•μΈ

```sql
SELECT id, email, llmApiKeys FROM "user" WHERE id = 'μ‚¬μ©μID';
```

`llmApiKeys` ν•„λ“μ— `anthropic` ν‚¤κ°€ μ•”νΈν™”λμ–΄ μ €μ¥λμ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

### API ν‚¤ μ €μ¥ ν™•μΈ μ—”λ“ν¬μΈνΈ (μ¶”κ°€ ν•„μ”)

ν„μ¬λ” μ €μ¥ ν›„ λ°”λ΅ ν™•μΈν•  μ μλ” μ—”λ“ν¬μΈνΈκ°€ μ—†μΌλ―€λ΅, λ‹¤μμ„ μ¶”κ°€ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤:

```typescript
@Get('api-keys')
@UseGuards(JwtAuthGuard)
async getApiKeys(@Request() req: AuthenticatedRequest) {
  // μ‚¬μ©μ API ν‚¤ μ΅΄μ¬ μ—¬λ¶€λ§ λ°ν™ (μ•”νΈν™”λ ν‚¤λ” λ°ν™ν•μ§€ μ•μ)
  const user = await this.userRepository.findOne({
    where: { id: req.user.userId },
    select: ['id', 'llmApiKeys'],
  });
  
  if (!user) {
    throw new NotFoundException('μ‚¬μ©μλ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤.');
  }
  
  return {
    hasOpenAI: !!user.llmApiKeys?.openai,
    hasGoogle: !!user.llmApiKeys?.google,
    hasAnthropic: !!user.llmApiKeys?.anthropic,
  };
}
```

## μμƒ μ›μΈ μ”μ•½

κ°€μ¥ κ°€λ¥μ„± λ†’μ€ μ›μΈλ“¤:

1. **API ν‚¤κ°€ μ €μ¥λμ§€ μ•μ**: ν”„λ΅ νΈμ—”λ“μ—μ„ μ €μ¥ μ”μ²­μ΄ μ‹¤ν¨ν–μ„ μ μμ
2. **λ³µνΈν™” μ‹¤ν¨**: μ•”νΈν™” ν‚¤κ°€ λ³€κ²½λμ—κ±°λ‚ λ³µνΈν™” κ³Όμ •μ— μ¤λ¥
3. **Provider μ„¤μ • μ¤λ¥**: AI μ„¤μ •μ—μ„ Providerκ°€ AnthropicμΌλ΅ λ³€κ²½λμ§€ μ•μ
4. **λ¨λΈ μ„ νƒ μ¤λ¥**: Anthropic Providerλ¥Ό μ‚¬μ©ν•λ”λ° Anthropic λ¨λΈμ΄ μ„ νƒλμ§€ μ•μ

## λΉ λ¥Έ ν•΄κ²° λ°©λ²•

1. **AI μ„¤μ • λ¨λ‹¬ μ—΄κΈ°**
2. **"π¤– AI λ¨λΈ" νƒ­ μ„ νƒ**
3. **Providerλ¥Ό "Anthropic (Claude)"λ΅ λ³€κ²½**
4. **λ¨λΈ μ„ νƒ (μ: "Claude 3.5 Sonnet")**
5. **"API ν‚¤ μ„¤μ •" β†’ "μ„¤μ •ν•κΈ°" ν΄λ¦­**
6. **Anthropic API Key μ…λ ¥ (`sk-ant-api03-...`)**
7. **"μ €μ¥" λ²„νΌ ν΄λ¦­**
8. **λ°±μ—”λ“ λ΅κ·Έμ—μ„ μ €μ¥ μ„±κ³µ λ©”μ‹μ§€ ν™•μΈ**
9. **μ±„ν…μ—μ„ λ©”μ‹μ§€ μ „μ†΅ν•μ—¬ ν…μ¤νΈ**

## μ¶”κ°€ κ°μ„  μ‚¬ν•­

- API ν‚¤ μ €μ¥ ν›„ μ¦‰μ‹ κ²€μ¦ν•λ” κΈ°λ¥ μ¶”κ°€
- API ν‚¤ μ ν¨μ„± κ²€μ¦ κΈ°λ¥ μ¶”κ°€
- μ €μ¥λ API ν‚¤ λ©λ΅ μ΅°ν κΈ°λ¥ μ¶”κ°€

